From dd4e23786bd33ab30f9fe522088d78b74d7c1fec Mon Sep 17 00:00:00 2001
From: Jun Jinhyuk <jinhyuk.jun@samsung.com>
Date: Tue, 21 Feb 2012 02:33:45 -0500
Subject: [PATCH] JQM resize content in scrollview

---
 .../js/jquery.mobile.fixHeaderFooter.js            |   71 +++++++++-----------
 1 files changed, 32 insertions(+), 39 deletions(-)
 mode change 100644 => 100755 libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js

diff --git a/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js b/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js
old mode 100644
new mode 100755
index 2aa10b5..953d489
--- a/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js
+++ b/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js
@@ -126,6 +126,27 @@ $.mobile.fixedToolbars = (function() {
 		}					
 		/* resize test : Jinhyuk    */
 
+
+		var s_theme_header = $( document ).find( ".ui-page-active" ).find( ":jqmData(role='header')" );
+		var s_theme_content = $( document ).find( ".ui-page-active" ).find( ":jqmData(role='content')" );
+		// data-role != "fixed", scrollview=false -> header scroll support
+		if( $.support.scrollview === false && s_theme_header.css("position") != "fixed" ){
+			s_theme_header.css( "position", "relative" );
+			s_theme_content
+				.css( "top", "0" )
+				.css( "height", "" );
+		} else if( $.support.scrollview === true ) {
+			if(s_theme_header.css( "position") != "fixed" )
+				s_theme_header.css( "position", "fixed" );
+				s_theme_content.css( "top", s_theme_header.height() );
+		}
+		
+		// resize content size in case scrollview
+		if( $.support.scrollview === true ) {
+			s_theme_content
+				.css( "height", document.documentElement.clientHeight - footer_filter.height() - s_theme_header.height());	
+		}
+		
 		if ( !autoHideMode && currentstate === "overlay" ) {
 			if ( !delayTimer ) {
 				/* Fixed header modify for theme-s : Jinhyuk */
@@ -280,6 +301,17 @@ $.mobile.fixedToolbars = (function() {
 				s_theme_content.addClass( "ui-title-content-" + title_style + "-height" );
 			}
 
+			// data-role != "fixed", scrollview=false -> header scroll support
+			if( $.support.scrollview === false && s_theme_header.css("position") != "fixed" ){
+				s_theme_header.css( "position", "relative" );
+				s_theme_content.css( "top", "0" );
+			} else if( $.support.scrollview === true ){
+				if( s_theme_header.css("position") != "fixed" )
+					s_theme_header.css( "position", "fixed" );
+					s_theme_content.css( "top", s_theme_header.height() );
+			}
+
+
 			/* resize footer : Jinhyuk    */
 			var footer_filter = $(document).find(":jqmData(role='footer')");
 			if( footer_filter.find(".ui-navbar").is(".ui-controlbar-s") ){
@@ -370,45 +402,6 @@ $.mobile.fixedToolbars = (function() {
 			$("body").children(":jqmData(role='header')").insertBefore($(event.target).find(":jqmData(role='content')").eq(0));
 		})
 
-		.live( "vclick", function( event, ui ) {
-/*
-			var previous_index = $(".ui-page-active").find(":jqmData(role='footer')" ).find(".ui-state-persist").parents("li").index();
-			var active_index = $(event.target).parents("li").index();
-			var navbar_filter = $(".ui-page-active").find(":jqmData(role='footer')" ).find(":jqmData(role='navbar')");
-			var element_count = navbar_filter.find('li').length;
-			var style = navbar_filter.jqmData( "style" );
-			var list_width = $(".ui-page-active").find('.ui-navbar').width()/element_count;
-			
-			var next_link = $(event.target).parents("a").attr("href");
-			
-			
-			$(".ui-page-active").addClass("ui-btn-hide-style");
-
-
-			if(navbar_filter.find(".ui-btn-animation").length == 0 && style != "toolbar"){					
-				$('<div class="ani-focus"></div>').appendTo(navbar_filter.children());
-				$(".ani-focus")
-					.addClass("ui-btn-animation")	
-					.removeClass("ui-btn-ani-verticalendposition")
-					.removeClass("ui-btn-ani-endposition");
-
-			}					
-				$(".ani-focus")				
-					.css("width", navbar_filter.width()/element_count )
-					.css("height",navbar_filter.css("height"))	
-					.css("left", previous_index * list_width);
-
-
-				$(".ui-btn-ani-startposition").css("-webkit-transform","translateX("+previous_index *list_width+")");
-				$(".ani-focus").addClass("ui-btn-ani-startposition");
-				
-				var t=setTimeout("",10);
-				$(".ui-btn-ani-endposition").css("-webkit-transform","translateX("+active_index *list_width+")");
-				$(".ani-focus").removeClass("ui-btn-ani-startposition");
-				$(".ani-focus").addClass("ui-btn-ani-endposition");
-*/
-		});
-		
 
 	// When a collapsiable is hidden or shown we need to trigger the fixed toolbar to reposition itself (#1635)
 	$( ".ui-collapsible-contain" ).live( "collapse expand", showEventCallback );
-- 
1.7.4.1

