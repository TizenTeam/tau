(function(e){var t=function(t){var n=t.isArray;t.Object={};var r=t.Object.same=function(s,o,u,a,f,l){var c=typeof s,h=n(s),p=typeof u,d;if(p==="string"||u===null){u=i[u];p="function"}if(p==="function"){return u(s,o,a,f)}u=u||{};if(s===null||o===null){return s===o}if(s instanceof Date||o instanceof Date){return s===o}if(l===-1){return c==="object"||s===o}if(c!==typeof o||h!==n(o)){return false}if(s===o){return true}if(h){if(s.length!==o.length){return false}for(var v=0;v<s.length;v++){d=u[v]===e?u["*"]:u[v];if(!r(s[v],o[v],s,o,d)){return false}}return true}else if(c==="object"||c==="function"){var m=t.extend({},o);for(var g in s){d=u[g]===e?u["*"]:u[g];if(!r(s[g],o[g],d,s,o,l===false?-1:e)){return false}delete m[g]}for(g in m){if(u[g]===e||!r(e,o[g],u[g],s,o,l===false?-1:e)){return false}}return true}return false};t.Object.subsets=function(e,n,r){var i=n.length,s=[];for(var o=0;o<i;o++){var u=n[o];if(t.Object.subset(e,u,r)){s.push(u)}}return s};t.Object.subset=function(e,t,n){n=n||{};for(var i in t){if(!r(e[i],t[i],n[i],e,t)){return false}}return true};var i={"null":function(){return true},i:function(e,t){return(""+e).toLowerCase()===(""+t).toLowerCase()},eq:function(e,t){return e===t},similar:function(e,t){return e==t}};i.eqeq=i.similar;return t.Object}(window.can);var n=function(t){if(!t.Object){throw new Error("can.fixture depends on can.Object. Please include it before can.fixture.")}var n=function(e){if(typeof steal!=="undefined"){if(t.isFunction(steal.config)){return steal.config().root.mapJoin(e).toString()}return steal.root.join(e).toString()}return(t.fixture.rootUrl||"")+e};var r=function(e,r){if(!t.fixture.on){return}var i=function(){};e.type=e.type||e.method||"GET";var s=f(e);if(!e.fixture){if(window.location.protocol==="file:"){i("ajax request to "+e.url+", no fixture found")}return}if(typeof e.fixture==="string"&&t.fixture[e.fixture]){e.fixture=t.fixture[e.fixture]}if(typeof e.fixture==="string"){var o=e.fixture;if(/^\/\//.test(o)){o=n(e.fixture.substr(2))}if(s){o=t.sub(o,s)}delete e.fixture;e.url=o;e.data=null;e.type="GET";if(!e.error){e.error=function(e,t,n){throw"fixtures.js Error "+t+" "+n}}}else{if(e.dataTypes){e.dataTypes.splice(0,0,"fixture")}if(s&&r){r.data=r.data||{};t.extend(r.data,s)}}},i=function(e,t,n,r){if(typeof e!=="number"){r=t;n=e;t="success";e=200}if(typeof t!=="string"){r=n;n=t;t="success"}if(e>=400&&e<=599){this.dataType="text"}return[e,t,s(this,n),r]},s=function(e,t){var n=e.dataTypes?e.dataTypes[0]:e.dataType||"json";if(!t||!t[n]){var r={};r[n]=t;t=r}return t};if(t.ajaxPrefilter&&t.ajaxTransport){t.ajaxPrefilter(r);t.ajaxTransport("fixture",function(n,r){n.dataTypes.shift();var o,u=false;return{send:function(a,f){o=setTimeout(function(){var t=function(){if(u===false){f.apply(null,i.apply(n,arguments))}},o=n.fixture(r,t,a,n);if(o!==e){f(200,"success",s(n,o),{})}},t.fixture.delay)},abort:function(){u=true;clearTimeout(o)}}})}else{var o=t.ajax;t.ajax=function(n){r(n,n);if(n.fixture){var s,u=new t.Deferred,a=false;u.getResponseHeader=function(){};u.then(n.success,n.fail);u.abort=function(){clearTimeout(s);a=true;u.reject(u)};s=setTimeout(function(){var t=function(){var e=i.apply(n,arguments),t=e[0];if((t>=200&&t<300||t===304)&&a===false){u.resolve(e[2][n.dataType])}else{u.reject(u,"error",e[1])}},r=n.fixture(n,t,n.headers,n);if(r!==e){u.resolve(r)}},t.fixture.delay);return u}else{return o(n)}}}var u=[],a=function(e,t){for(var n=0;n<u.length;n++){if(c._similar(e,u[n],t)){return n}}return-1},f=function(e){var t=a(e);if(t>-1){e.fixture=u[t].fixture;return c._getData(u[t].url,e.url)}},l=function(t){var n=t.data.id;if(n===e&&typeof t.data==="number"){n=t.data}if(n===e){t.url.replace(/\/(\d+)(\/|$|\.)/g,function(e,t){n=t})}if(n===e){n=t.url.replace(/\/(\w+)(\/|$|\.)/g,function(e,t){if(t!=="update"){n=t}})}if(n===e){n=Math.round(Math.random()*1e3)}return n};var c=t.fixture=function(n,r){if(r!==e){if(typeof n==="string"){var i=n.match(/(GET|POST|PUT|DELETE) (.+)/i);if(!i){n={url:n}}else{n={url:i[2],type:i[1]}}}var s=a(n,!!r);if(s>-1){u.splice(s,1)}if(r==null){return}n.fixture=r;u.push(n)}else{t.each(n,function(e,t){c(t,e)})}};var h=t.replacer;t.extend(t.fixture,{_similar:function(e,n,r){if(r){return t.Object.same(e,n,{fixture:null})}else{return t.Object.subset(e,n,t.fixture._compare)}},_compare:{url:function(e,t){return!!c._getData(t,e)},fixture:null,type:"i"},_getData:function(e,n){var r=[],i=e.replace(".","\\.").replace("?","\\?"),s=(new RegExp(i.replace(h,function(e,t){r.push(t);return"([^/]+)"})+"$")).exec(n),o={};if(!s){return null}s.shift();t.each(r,function(e){o[e]=s.shift()});return o},store:function(n,r,i){var s=0,o=function(e){for(var t=0;t<f.length;t++){if(e==f[t].id){return f[t]}}},u={},a,f,c;if(t.isArray(n)&&typeof n[0]==="string"){a=n;n=r;r=i;i=arguments[3]}else if(typeof n==="string"){a=[n+"s",n];n=r;r=i;i=arguments[3]}if(typeof n==="number"){f=[];c=function(){f=[];for(var e=0;e<n;e++){var i=r(e,f);if(!i.id){i.id=e}s=Math.max(i.id+1,s+1)||f.length;f.push(i)}if(t.isArray(a)){t.fixture["~"+a[0]]=f;t.fixture["-"+a[0]]=u.findAll;t.fixture["-"+a[1]]=u.findOne;t.fixture["-"+a[1]+"Update"]=u.update;t.fixture["-"+a[1]+"Destroy"]=u.destroy;t.fixture["-"+a[1]+"Create"]=u.create}}}else{i=r;var h=n;c=function(){f=h.slice(0)}}t.extend(u,{findAll:function(n){n=n||{};var r=f.slice(0);n.data=n.data||{};t.each((n.data.order||[]).slice(0).reverse(),function(e){var t=e.split(" ");r=r.sort(function(e,n){if(t[1].toUpperCase()!=="ASC"){if(e[t[0]]<n[t[0]]){return 1}else if(e[t[0]]===n[t[0]]){return 0}else{return-1}}else{if(e[t[0]]<n[t[0]]){return-1}else if(e[t[0]]===n[t[0]]){return 0}else{return 1}}})});t.each((n.data.group||[]).slice(0).reverse(),function(e){var t=e.split(" ");r=r.sort(function(e,n){return e[t[0]]>n[t[0]]})});var s=parseInt(n.data.offset,10)||0,o=parseInt(n.data.limit,10)||f.length-s,u=0;for(var a in n.data){u=0;if(n.data[a]!==e&&(a.indexOf("Id")!==-1||a.indexOf("_id")!==-1)){while(u<r.length){if(n.data[a]!=r[u][a]){r.splice(u,1)}else{u++}}}}if(typeof i==="function"){u=0;while(u<r.length){if(!i(r[u],n)){r.splice(u,1)}else{u++}}}else if(typeof i==="object"){u=0;while(u<r.length){if(!t.Object.subset(r[u],n.data,i)){r.splice(u,1)}else{u++}}}return{count:r.length,limit:n.data.limit,offset:n.data.offset,data:r.slice(s,s+o)}},findOne:function(e,t){var n=o(l(e));if(typeof n==="undefined"){return t(404,"Requested resource not found")}t(n)},update:function(e,n){var r=l(e),i=o(r);if(typeof i==="undefined"){return n(404,"Requested resource not found")}t.extend(i,e.data);n({id:r},{location:e.url||"/"+l(e)})},destroy:function(e,t){var n=l(e),r=o(n);if(typeof r==="undefined"){return t(404,"Requested resource not found")}for(var i=0;i<f.length;i++){if(f[i].id==n){f.splice(i,1);break}}return{}},create:function(e,n){var i=r(f.length,f);t.extend(i,e.data);if(!i.id){i.id=s++}f.push(i);n({id:i.id},{location:e.url+"/"+i.id})}});c();return t.extend({getId:l,find:function(e){return o(l(e))},reset:c},u)},rand:function p(t,n,r){if(typeof t==="number"){if(typeof n==="number"){return t+Math.floor(Math.random()*(n-t))}else{return Math.floor(Math.random()*t)}}var i=p;if(n===e){return i(t,i(t.length+1))}var s=[];t=t.slice(0);if(!r){r=n}r=n+Math.round(i(r-n));for(var o=0;o<r;o++){s.push(t.splice(i(t.length),1)[0])}return s},xhr:function(e){return t.extend({},{abort:t.noop,getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},open:t.noop,overrideMimeType:t.noop,readyState:4,responseText:"",responseXML:null,send:t.noop,setRequestHeader:t.noop,status:200,statusText:"OK"},e)},on:true});t.fixture.delay=200;t.fixture.rootUrl=n("");t.fixture["-handleFunction"]=function(e){if(typeof e.fixture==="string"&&t.fixture[e.fixture]){e.fixture=t.fixture[e.fixture]}if(typeof e.fixture==="function"){setTimeout(function(){if(e.success){e.success.apply(null,e.fixture(e,"success"))}if(e.complete){e.complete.apply(null,e.fixture(e,"complete"))}},t.fixture.delay);return true}return false};t.fixture.overwrites=u;t.fixture.make=t.fixture.store;return t.fixture}(window.can,e,t)})()
