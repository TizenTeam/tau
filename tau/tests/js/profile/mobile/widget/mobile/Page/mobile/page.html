<!DOCTYPE html>
<html>
	<head>
		<title>Page tests</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../../../../../../libs/qunit-1.11.0.css">
	</head>
	<body>
		<div id="qunit"></div>
		<div id="qunit-fixture">
			<div id="page1" data-role="page" class="test">
				<div data-role="header" id="header1">
					<h1 id="h1">Header</h1>
				</div>
				<div data-role="content" id="content1">Content</div>
				<div data-role="footer" id="footer1">
					<h1 id="h2">Footer</h1>
				</div>
			</div>
			<div id="page2" data-role="page">
				<div data-role="header" id="header2">Header</div>
				<div data-role="content" id="content2">Content</div>
				<div data-role="footer" id="footer2">Footer</div>
			</div>

			<div id="page3" data-role="page">
				<div data-role="header"></div>
				<div data-role="content"></div>
			</div>

		</div>
		<script src="../../../../../../../libs/jquery.js"></script>
		<script src="../../../../../../../libs/qunit-1.11.0.js" type="text/javascript"></script>
		<script src="../../../../../../../libs/support.js"></script>
		<script>
			module('profile/mobile/widget/mobile/Page', {
				teardown: function () {
					ej.engine._clearBindings();
				}
			});

			test('Page DOM created', function () {
				var page = document.getElementById('page1'),
					header = document.getElementById('header1'),
					content = document.getElementById('content1'),
					footer = document.getElementById('footer1'),
					eventsCalled = {};
				$(document).on("pagebeforecreate pagecreate", function(e) {
					eventsCalled[e.type] = true;
				});
				$('#page1').page();
				equal(page.getAttribute('data-tau-bound'), "Page", "Page widget is created");
				ok(page.classList.contains('ui-page'), 'Page has ui-page class');
				ok(page.classList.contains('test'), "Previous class wasn't removed");
				ok(eventsCalled.pagebeforecreate , 'pagebeforecreate called');
				ok(eventsCalled.pagecreate, 'pagecreate called');
				$(document).off("pagebeforecreate pagecreate");

				ok(header.classList.contains('ui-header'), 'Header enhanced');

				ok(content.classList.contains('ui-content'), 'Content enhanced');
				equal(content.getAttribute('role'), 'main', 'Content has role=main');

				ok(footer.classList.contains('ui-footer'), 'Footer enhanced');
			});

			test('Page titles', function () {
				var h1 = document.getElementById('h1'),
					h2 = document.getElementById('h2');
				$('#page1').page();
				ok(h1.classList.contains('ui-title'), 'Title has been enhanced');
				equal(h1.getAttribute('role'), 'heading');
				equal(h1.getAttribute('aria-level'), '1');
				equal(h1.getAttribute('aria-label'), 'title');
				ok(h2.classList.contains('ui-title'), 'Title has been enhanced');
				equal(h2.getAttribute('role'), 'heading');
				equal(h2.getAttribute('aria-level'), '1');
				equal(h2.getAttribute('aria-label'), 'title');
			});

			test('Sets -fixed classes to header and footer', function(){
				var header = document.getElementById('header2'),
					footer = document.getElementById('footer2');

				$('#page2').page();

				ok(header.classList.contains('ui-header-fixed'), 'Header has ui-header-fixed');
				ok(footer.classList.contains('ui-footer-fixed'), 'Footer has ui-footer-fixed');
			});

			test('Changing active page causes ui-overlay- class change (on body)', function(){
				var bodyClassList = document.body.classList,
					page3 = ej.engine.getBinding($("#page3").page()[0]),
					pageContainer;
					ej.engine.run();
					pageContainer =
							ej.engine.getRouter().getContainer().element;

					page3.setActive(true, pageContainer);
					ok(bodyClassList.contains('ui-overlay-s'), 'Body has default theme class ui-overlay-s');
					page3.setActive(false, pageContainer);
					ok(!bodyClassList.contains('ui-overlay-s'), 'Body doesn\'t have default theme class ui-overlay-s');
			});

		var tauConfig = {
			"autorun": false
		};
		</script>
		<script type="text/javascript"
				src="../../../../../../../libs/dist/js/tau.js"></script>

	</body>
</html>
